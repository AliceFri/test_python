https://xiaolincoding.com/mysql/base/how_select.html

    mysql的架构 分为两层： Server层和存储引擎层

    Server层负责建立连接, 分析和执行SQL
        （连接器，查询缓存，解析器，预处理器，优化器，执行器等； 内置函数等）

    存储引擎层负责数据的存储和提取
        （数据存储与提取，索引等）

---
### 1. 连接器
    查看有多少个客户端连接？     show processlist

    空闲连接有最大空闲时长     show variables like 'wait_timeout';

    手动 断开空闲的连接      kill connection + id;

    mysql的最大连接数         max_connections;

    mysql 长连接占用内存的问题？
        1. 定期断开长连接
        2. 客户端主动重置连接 mysql_reset_connection();

### 2. 查询缓存
    mysql 8 之前可以设置关闭， 8之后直接关闭了；

    对于更新频繁的表，查询缓存命中率很低，很鸡肋（缓存适用于更新不频繁的表）；

------

### 3. 解析SQL

    词法分析+语法分析；

    检查语法错误！

### 4. 执行SQL
    
    预处理阶段： 1.检查表/字段是否存在 2. 将 * 扩展为表上的所有列
    
    优化阶段： 确定sql语句的执行计划

    执行器： 和存储引擎交互，把条件交给存储引擎，判断存储引擎返回的结果是否符合条件
        
        server层每从存储引擎读到一条存储记录就发给客户端，客户端等到查询语句完成时，才显示所有的记录

        索引下推： 减少二级索引在查询时的回表操作；（由存储引擎做这件事情）

----

### 总结

#### 执行一条SQL语句，期间发生了什么

    mysql的架构分为 Server层 和 存储引擎层
    1. 客户端向 mysql server层，发起连接，发起sql查询
    2. mysql8之前会先进行 查询缓存
    3. 然后sql语句会进行语法分析和词法分析，看是否符合sql语法
    4. 然后是sql执行阶段： 
        1. 预处理阶段，检查表/字段是否存在等
        2. 优化阶段，确定sql语句的执行计划
        3. 执行阶段，从存储引擎读取记录，返回给客户端。