from typing import List

# 给你一个整数数组 nums 和两个整数 minK 以及 maxK 。
#
# nums 的定界子数组是满足下述条件的一个子数组：
#
# 子数组中的 最小值 等于 minK 。
# 子数组中的 最大值 等于 maxK 。
# 返回定界子数组的数目。
#
# 子数组是数组中的一个连续部分。


class Solution:
    def countSubarrays(self, nums: List[int], minK: int, maxK: int) -> int:
        dp = [0] * (len(nums) + 1)
        mins, maxs, ibegin = None, None, 1
        for i in range(1, len(nums) + 1):
            ii = i - 1
            if nums[ii] < minK or nums[ii] > maxK:
                mins, maxs, ibegin = None, None, i + 1
            elif nums[ii] > minK and nums[ii] < maxK:
                dp[i] = dp[i - 1]
            else:
                if mins and maxs:
                    if nums[ii] == minK and nums[ii] == maxK:
                        dp[i] = mins - ibegin + 1 + 1
                    elif nums[ii] == minK:
                        dp[i] = maxs - ibegin + 1
                    elif nums[ii] == maxK:
                        dp[i] = mins - ibegin + 1
                elif mins:
                    if nums[ii] == maxK:
                        dp[i] = mins - ibegin + 1
                elif maxs:
                    if nums[ii] == minK:
                        dp[i] = maxs - ibegin + 1
                else:
                    if nums[ii] == minK == maxK:
                        dp[i] = 1

                if nums[ii] == minK:
                    mins = i
                if nums[ii] == maxK:
                    maxs = i

        print(dp)
        return sum(dp)


if __name__ == "__main__":
    print(
        Solution().countSubarrays(
            [
                35054,
                398719,
                945315,
                945315,
                820417,
                945315,
                35054,
                945315,
                171832,
                945315,
                35054,
                109750,
                790964,
                441974,
                552913,
            ],
            35054,
            945315,
        )
    )
# [[1, 3], [1, 5], [1, 6], [1, 7], [1, 8], [1, 9], [1, 10], [2, 3], [2, 5], [2, 6], [2, 7], [2, 8], [2, 9], [2, 10], [3, 4], [4, 5], [4, 6], [4, 7], [4, 8], [4, 9], [4, 10]]

# 1 2 4
# 3 5 6 7 8 9 10

# [[1, 4], [1, 5], [1, 6], [1, 7], [1, 8], [1, 9], [1, 10], [1, 12], [1, 16], [1, 17], [1, 20], [1, 21], [1, 25], [1, 27], [1, 35], [1, 36], [1, 38], [1, 39], [1, 43], [1, 48],
# [2, 11], [2, 22], [2, 30], [2, 32], [2, 37], [2, 41], [2, 46], [3, 11], [3, 22], [3, 26], [3, 29], [3, 30], [3, 32], [3, 37], [3, 42], [3, 46], [4, 22], [4, 30], [4, 32], [4, 37], [4, 41], [4, 42], [5, 11], [5, 29], [5, 30], [5, 37], [5, 41], [6, 29], [6, 30], [6, 37], [6, 41], [6, 42], [6, 46], [7, 11], [7, 22], [7, 26], [7, 30], [7, 37], [7, 42], [8, 30], [8, 32], [8, 41], [8, 47], [9, 37], [9, 42], [9, 46], [9, 47], [10, 22], [10, 30], [10, 37], [10, 46], [11, 14], [11, 15], [11, 16], [11, 18], [11, 23], [11, 25], [11, 27], [11, 38], [11, 48], [12, 32], [12, 47], [13, 22], [13, 41], [14, 29], [14, 42], [14, 47], [15, 26], [15, 46], [15, 47], [16, 22], [16, 29], [16, 37], [17, 26], [17, 30], [17, 32], [17, 37], [17, 46], [17, 47], [18, 29], [18, 37], [18, 42], [18, 46], [18, 47], [19, 41], [20, 22], [20, 29], [20, 42], [20, 46], [20, 47], [21, 32], [21, 37], [21, 41], [21, 46], [21, 47], [22, 24], [22, 25], [22, 28], [22, 34], [22, 36], [22, 40], [22, 44], [22, 45], [22, 48], [22, 49], [22, 50], [23, 26], [23, 29], [23, 30], [23, 37], [23, 41], [23, 42], [23, 46], [24, 26], [24, 46], [25, 41], [25, 42], [26, 28], [26, 34], [26, 38], [26, 39], [26, 40], [26, 43], [26, 45], [26, 49], [27, 29], [27, 30], [28, 30], [28, 37], [28, 42], [29, 31], [29, 33], [29, 36], [29, 40], [29, 44], [29, 45], [30, 33], [30, 38], [30, 39], [30, 44], [30, 45], [30, 48], [30, 49], [31, 32], [31, 47], [32, 33], [32, 34], [32, 35], [32, 39], [32, 44], [32, 45], [33, 37], [33, 42], [34, 37], [35, 42], [36, 41], [36, 42], [36, 46], [37, 43], [37, 48], [38, 41], [39, 41], [40, 42], [41, 43], [41, 44], [41, 48], [41, 50], [42, 43], [42, 45], [42, 48], [42, 50], [45, 46], [46, 49], [47, 48], [47, 49], [47, 50]]
# 1 2 3
# 4 5 6 7 8 9 10 11 12 16 17 20 21 25 27 35 36 38 39 43 48 11 22 30 32 37 41 46