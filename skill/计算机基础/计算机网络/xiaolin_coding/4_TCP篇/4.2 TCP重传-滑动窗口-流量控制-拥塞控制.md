### 1. 重传机制

    TCP 实现可靠传输的方式之一，是通过序列号与确认应答。

##### 1.1 超时重传

    在发送数据时，设定一个定时器，当超过指定的时间后，没有收到对方的 ACK 确认应答报文，就会重发该数据，也就是我们常说的超时重传。

    RTO: 超时重传时间， RTO较大时，重发发现慢，效率低； RTO较小，没有丢包就重发，增加网络堵塞。
    RTT: 往返时延
    所以「超时重传时间 RTO 的值」应该是一个动态变化的值。

    如果超时重发的数据，再次超时的时候，又需要重传的时候，TCP 的策略是超时间隔加倍。

##### 1.2 快速重传

    不以时间为驱动，而是以数据驱动重传。
    
    三次同样的ACK，就会触发快速重传，。 有个问题： 是重传一个报文呢还是重传已发送的报文。

    SACK方法 （选择性确认）
    字段里加一个 SACK 的东西，它可以将已收到的数据的信息发送给「发送方」，
    这样发送方就可以知道哪些数据收到了，哪些数据没收到，知道了这些信息，就可以只重传丢失的数据。


----------------------------

### 2. 滑动窗口

    无需等待确认应答，而可以继续发送数据的最大值。

    窗口的实现实际上是操作系统开辟的一个缓存空间，发送方主机在等到确认应答返回之前，必须在缓冲区中保留已发送的数据。
    如果按期收到确认应答，此时数据就可以从缓存区清除。

    这个字段是接收端告诉发送端自己还有多少缓冲区可以接收数据。于是发送端就可以根据这个接收端的处理能力来发送数据，而不会导致接收端处理不过来。
    所以，通常窗口的大小是由接收方的窗口大小来决定的。

    控制，网络中传输的数据的总大小在一定范围内

----------------------------

### 3. 流量控制

    TCP 提供一种机制可以让「发送方」根据「接收方」的实际接收能力控制发送的数据量，这就是所谓的流量控制。
    滑动窗口就是实现流量控制的方式

    如果收到接受方的零窗口通知，会启动定时器，发送窗口探测报文。


    糊涂窗口综合症
    
    如果接收方腾出几个字节并告诉发送方现在有几个字节的窗口，而发送方会义无反顾地发送这几个字节，这就是糊涂窗口综合症。

    1. 接收方不通告小窗口给发送方
        窗口足够小时就通告窗口为0
    2. 发送方避免发送小数据
        延时处理，等到窗口大小 >= mss, 并且数据大小 >= mss,才发送

流量控制是避免 接受方的缓存被填满
拥塞控制是避免 网络不好的情况下还发送大量数据导致网络更加恶化
-----------------------------

### 4. 拥塞窗口 cwnd

    拥塞窗口 cwnd是发送方维护的一个的状态变量，它会根据网络的拥塞程度动态变化的。

    拥塞窗口 和 接收窗口 一起控制发起方是否发送数据 swnd = min(cwnd, rwnd)

    拥塞窗口 cwnd 变化的规则：
        只要网络中没有出现拥塞，cwnd 就会增大；
        但网络中出现了拥塞，cwnd 就减少；

    发生了超时重传，就会认为网络出现了拥塞。

##### 4.1 慢启动

    初始化 cwnd = 1
    当发送方每收到一个 ACK，拥塞窗口 cwnd 的大小就会加 1。

    慢启动呈指数型的增长， 达到慢启动门限时  ssthresh  , 使用拥塞避免算法

#### 4.2 拥塞避免

    每当收到一个 ACK 时，cwnd 增加 1/cwnd

    线性增长

#### 4.3 拥塞发生

    发生超时重传时： ssthresh 设为 cwnd/2; cwnd 恢复为初始值

#### 4.4 快速恢复

    发生快速重传时, 快速恢复： 
    1. cwnd 设为 cwnd/2, ssthresh 设为 cwnd
    2. cwnd = ssthresh + 3
    3. ACK 确认了新的数据， cwnd  设置为第一步的ssthresh

    发生快速重传时， 第一步 ssthresh = cwnd/2, cwnd=ssthresh+3. 减小cwnd, +3代表快速重传时已经确认收到了3个重复的数据包
    继续重传丢失的数据包，如果再收到重复的 ACK，那么 cwnd 增加 1。加 1 代表每个收到的重复的 ACK 包，都已经离开了网络。
    这个过程的目的是尽快将丢失的数据包发给目标。
    如果收到新数据的 ACK 后，把 cwnd 设置为第一步中的 ssthresh 的值，恢复过程结束。
