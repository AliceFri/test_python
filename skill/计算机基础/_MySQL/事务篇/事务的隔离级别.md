### 1. 事务的四大特性

    ACID

    Atomicity: 原子性， 一个事务的全部操作，要么全部完成，要么全部不完成；

    Consistency: 一致性, 事务操作前后均满足约束，数据库保持一致性状态；

    Isolation: 隔离性， 事务之间互相不可见

    Durabiliey: 持久性

    A： undo log(回滚日志)来保证的
    I： MVCC 或锁机制 实现
    D： redo log(重做日志)来保证的

### 2. 事务的隔离级别

    RU： 读未提交， 会有脏读问题
    RC： 读已提交， 会有 不可重复读问题
    RR： 可重复读， 会有幻读问题    innodb默认隔离级别
    SE： 串行化

### 3. Read View

    读视图，可以理解为某一时间的快照

    有四个重要的字段：
    m_ids:  创建read view时, 活跃事务 的事务id列表。
    min_trx_id: m_ids中的最小值
    max_trx_id: 全局事务中最大的事务id值 + 1
    creator_trx_id: 创建 read view的事务的事务id

    记录里的两个隐藏列：
    1. trx_id 事务id 
    2. roll_pointer 回滚指针，指向undo日志里的旧版本记录

    一个事务去访问记录的时候，除了自己的更新记录总是可见之外：
    1. 小于 min_trx_id ，可见； 创建readview前事务已提交
    2. 大于等于 max_trx_id.不可见，创建readview后的事务
    3. 在m_ids里， 不可见， 活跃事务
    4. 不在m_ids里， 可见， 已提交


### 4. 可重复读
    可重复读隔离级别是启动事务时生成一个 Read View，然后整个事务期间都在用这个 Read View。

### 5. 读提交
    读提交隔离级别是在每次读取数据时，都会生成一个新的 Read View。


### 6. 可重复读 完全解决幻读了吗

    快照读： 普通select语句， MVCC方式解决了幻读

    当前读： select ... for update 等语句， 可以通过 next-key lock (记录锁+间隙锁)
    

    可重复读隔离级别下虽然很大程度上避免了幻读，但是还是没有能完全解决幻读。